# note we don't need map pairs here
COVERAGE_DONE?=$(COVERAGE_DIR)/.done
$(COVERAGE_DONE): $(FILTER_DONE)
	$(call _start,$(COVERAGE_DIR))
	$(call _time,$(MAP_DIR),coverage) $(_md)/pl/coverage.pl \
		$(CONTIG_TABLE) \
		$(CONTIG_FIELD) \
		$(FILTER_DIR) \
		$(MAP_BINSIZE) \
		$(COVERAGE_DIR)
	$(_end_touch)

# note we use all contigs when mapping but for coverage we use only the long contigs
$(COVERAGE_TABLE): $(COVERAGE_DONE)
	$(_start)
	$(_R) $(_md)/R/coverage_table.r coverage.table \
		table=$(CONTIG_TABLE) \
		field=$(CONTIG_FIELD) \
		idir=$(COVERAGE_DIR) \
		ofn=$@
	$(_end)
coverage: $(COVERAGE_TABLE)

# TBD: median/mean contig coverage. no need to bin here.
